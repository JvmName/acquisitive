import kotlin.Int;

getIdRange:
SELECT hid.id, hid.rank
FROM HnIdEntity hid
WHERE
    hid.fetchMode = :fetchMode
    AND hid.rank BETWEEN IIF(
        :startId IS NOT NULL,
        (SELECT rank FROM HnIdEntity WHERE HnIdEntity.id = :startId),
        0
    ) AND IIF(
        :startId IS NOT NULL,
        (SELECT (rank + :window) - 1 FROM HnIdEntity WHERE HnIdEntity.id = :startId),
        :window - 1
   )
ORDER BY hid.rank ASC;

insertId:
INSERT OR REPLACE INTO HnIdEntity VALUES ?;

insertItem:
INSERT OR REPLACE INTO HnItemEntity VALUES ?;

insertIdItem {
INSERT OR REPLACE INTO HnIdEntity(id, fetchMode, rank)
VALUES (:id, :fetchMode, :rank);

INSERT OR REPLACE INTO HnItemEntity(
  id, fetchMode, rank, type, author, time,
  dead, deleted, kids, title, url, text,
  score, descendants, parent, poll,
  parts
)
VALUES
  (
    : id, : fetchMode, : rank, : type, : author,
    : time, : dead, : deleted, : kids, : title,
    : url, : text, : score, : descendants,
    : parent, : poll, : parts
  );
}

getRankDistanceForId:
SELECT
    hid.rank,
    COALESCE((SELECT MAX(rank) FROM HnIdEntity), 0) AS idMax,
    COALESCE((SELECT MAX(rank) FROM HnItemEntity), 0) AS itemMax
FROM HnIdEntity hid
WHERE hid.id = :id;

getItemForId:
SELECT *
FROM HnItemEntity
WHERE id = :id AND fetchMode = :mode;

deleteAllByIds{
    DELETE FROM HnIdEntity WHERE HnIdEntity.fetchMode = :fetchMode AND HnIdEntity.id IN :idList;
    DELETE FROM HnItemEntity WHERE HnItemEntity.fetchMode = :fetchMode AND HnItemEntity.id IN :idList ;
}

deleteIdByFetchMode{
    DELETE FROM HnIdEntity WHERE fetchMode = :fetchMode;
    DELETE FROM HnItemEntity WHERE fetchMode = :fetchMode;
}